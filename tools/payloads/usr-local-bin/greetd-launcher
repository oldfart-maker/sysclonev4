#!/bin/sh
set -eu

CMD="/usr/local/bin/start-sway"
[ -n "${XDG_SESSION_TYPE:-}" ] || export XDG_SESSION_TYPE=wayland
[ -n "${XDG_CURRENT_DESKTOP:-}" ] || export XDG_CURRENT_DESKTOP=sway

# Flags confirmed by `tuigreet --help` on your Pi
FLAGS="--time --issue --user-menu --remember --asterisks"
SESS="/usr/share/wayland-sessions:/usr/local/share/wayland-sessions"

if command -v tuigreet >/dev/null 2>&1; then
  exec /usr/bin/tuigreet $FLAGS --sessions "$SESS" --cmd "$CMD"
elif command -v agreety >/dev/null 2>&1; then
  exec /usr/bin/agreety --cmd "$CMD"
else
  echo "No greeter found (tuigreet/agreety). Falling back to /bin/login." >&2
  exec /bin/login -p
fi
